
{{- define "osctl_volumes" }}
          - name: osctl-config
            configMap:
              name: osctl-configmap
              defaultMode: 420
          - name: osctl-tenants
            configMap:
              name: osctltenants
              defaultMode: 420
          - name: osctl-indices-config
            configMap:
              name: osctlindicesconfig
              defaultMode: 420
{{- include "osctl_cert_volumes" . }}
{{- end }}

{{- define "osctl_cert_volumes" }}
{{- if eq .Values.opendistro.certificates.type "custom" }}
          - name: certs
            secret:
              secretName: opendistro-tls-data
              defaultMode: 420
{{- else if eq .Values.opendistro.certificates.type "cluster" }}
          - name: certs
            secret:
              secretName: opendistro-certs
              defaultMode: 420
          - name: admin-certs
            secret:
              secretName: opendistro-admin-certs
              defaultMode: 420
{{- end }}
{{- end }}

{{- define "osctl_volume_mounts" }}
            - name: osctl-config
              mountPath: /app/config.yaml
              subPath: config.yml
              readOnly: true
            - name: osctl-config
              mountPath: /app/osctltenants.yaml
              subPath: osctltenants.yml
              readOnly: true
            - name: osctl-config
              mountPath: /app/osctlindicesconfig.yaml
              subPath: osctlindicesconfig.yml
              readOnly: true
{{- include "osctl_cert_volume_mounts" . }}
{{- end }}

{{- define "osctl_cert_volume_mounts" }}
{{- if eq .Values.opendistro.certificates.type "custom" }}
            - mountPath: /etc/ssl/certs/admin-crt.pem
              name: certs
              subPath: admin-crt.pem
              readOnly: true
            - mountPath: /etc/ssl/certs/admin-key.pem
              name: certs
              subPath: admin-key.pem
              readOnly: true
{{- else if eq .Values.opendistro.certificates.type "cluster" }}
            - mountPath: /etc/ssl/certs/admin-crt.pem
              name: admin-certs
              subPath: tls.crt
              readOnly: true
            - mountPath: /etc/ssl/certs/admin-key.pem
              name: admin-certs
              subPath: tls.key
              readOnly: true
{{- end }}
{{- end }}

